{"version":3,"file":"datascroller.js","sourceRoot":"","sources":["datascroller.ts"],"names":[],"mappings":";;;;;;;;;;AAAA,qBAAwJ,eAAe,CAAC,CAAA;AACxK,uBAA2B,iBAAiB,CAAC,CAAA;AAC7C,uBAAqB,kBAAkB,CAAC,CAAA;AACxC,uBAAqB,kBAAkB,CAAC,CAAA;AACxC,uBAA2B,kBAAkB,CAAC,CAAA;AAC9C,2BAAyB,mBAAmB,CAAC,CAAA;AAuB7C;IAsCI,sBAAmB,EAAc,EAAE,OAAwB,EAAS,QAAkB,EAAS,UAAsB;QAAlG,OAAE,GAAF,EAAE,CAAY;QAAmC,aAAQ,GAAR,QAAQ,CAAU;QAAS,eAAU,GAAV,UAAU,CAAY;QA9B3G,eAAU,GAAsB,IAAI,mBAAY,EAAE,CAAC;QAMpD,WAAM,GAAW,GAAG,CAAC;QAcvB,iBAAY,GAAU,EAAE,CAAC;QAEzB,UAAK,GAAW,CAAC,CAAC;QASrB,IAAI,CAAC,MAAM,GAAG,OAAO,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;IAChD,CAAC;IAED,sCAAe,GAAf;QAAA,iBAaC;QAZG,EAAE,CAAA,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;YACX,IAAI,CAAC,IAAI,EAAE,CAAC;QAChB,CAAC;QAED,EAAE,CAAA,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC;YACb,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,IAAI,CAAC,MAAM,EAAE,OAAO,EAAE;gBAC7D,KAAI,CAAC,IAAI,EAAE,CAAC;YAChB,CAAC,CAAC,CAAC;QACP,CAAC;QACD,IAAI,CAAC,CAAC;YACF,IAAI,CAAC,kBAAkB,EAAE,CAAC;QAC9B,CAAC;IACL,CAAC;IAED,gCAAS,GAAT;QACI,IAAI,OAAO,GAAG,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;QAE3C,EAAE,CAAA,CAAC,OAAO,CAAC,CAAC,CAAC;YACT,EAAE,CAAA,CAAC,IAAI,CAAC,IAAI,CAAC;gBACT,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC,KAAK,CAAC;YACnC,IAAI;gBACA,IAAI,CAAC,IAAI,EAAE,CAAC;QACpB,CAAC;IACL,CAAC;IAED,2BAAI,GAAJ;QACI,EAAE,CAAA,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;YACX,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC;gBACjB,KAAK,EAAE,IAAI,CAAC,KAAK;gBACjB,IAAI,EAAE,IAAI,CAAC,IAAI;aAClB,CAAC,CAAC;QACP,CAAC;QACD,IAAI,CAAC,CAAC;YACF,GAAG,CAAA,CAAC,IAAI,CAAC,GAAG,IAAI,CAAC,KAAK,EAAE,CAAC,GAAG,CAAC,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC;gBACxD,EAAE,CAAA,CAAC,CAAC,IAAI,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC,CAAC;oBACxB,KAAK,CAAC;gBACV,CAAC;gBAED,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;YAC1C,CAAC;QACL,CAAC;QACD,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,IAAI,CAAC;IACxC,CAAC;IAED,4BAAK,GAAL;QACI,IAAI,CAAC,KAAK,GAAG,CAAC,CAAC;QACf,IAAI,CAAC,YAAY,GAAG,EAAE,CAAC;QACvB,IAAI,CAAC,IAAI,EAAE,CAAC;IAChB,CAAC;IAED,8BAAO,GAAP;QACI,MAAM,CAAC,CAAC,IAAI,CAAC,YAAY,IAAE,CAAC,IAAI,CAAC,YAAY,CAAC,MAAM,IAAI,CAAC,CAAC,CAAC;IAC/D,CAAC;IAED,6CAAsB,GAAtB;QACI,MAAM,CAAC;YACH,KAAK,EAAE,IAAI,CAAC,KAAK;YACjB,IAAI,EAAE,IAAI,CAAC,IAAI;SAClB,CAAC;IACN,CAAC;IAED,yCAAkB,GAAlB;QAAA,iBA4BC;QA3BG,EAAE,CAAA,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC;YACb,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC,UAAU,CAAC,UAAU,CAAC,IAAI,CAAC,EAAE,CAAC,aAAa,EAAE,6BAA6B,CAAC,CAAC;YAEvG,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,IAAI,CAAC,cAAc,EAAE,QAAQ,EAAE;gBACtE,IAAI,SAAS,GAAG,KAAI,CAAC,cAAc,CAAC,SAAS,CAAC;gBAC9C,IAAI,YAAY,GAAG,KAAI,CAAC,cAAc,CAAC,YAAY,CAAC;gBACpD,IAAI,cAAc,GAAG,KAAI,CAAC,cAAc,CAAC,YAAY,CAAC;gBAEtD,EAAE,CAAA,CAAC,CAAC,SAAS,IAAI,CAAC,CAAC,YAAY,GAAG,KAAI,CAAC,MAAM,CAAC,GAAG,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;oBAClE,KAAI,CAAC,IAAI,EAAE,CAAC;gBAChB,CAAC;YACL,CAAC,CAAC,CAAC;QACP,CAAC;QACD,IAAI,CAAC,CAAC;YACF,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC,QAAQ,CAAC,YAAY,CAAC,QAAQ,EAAE,QAAQ,EAAE;gBACjE,IAAI,OAAO,GAAG,QAAQ,CAAC,IAAI,CAAC;gBAC5B,IAAI,UAAU,GAAG,QAAQ,CAAC,eAAe,CAAC;gBAC1C,IAAI,SAAS,GAAG,CAAC,MAAM,CAAC,WAAW,IAAE,QAAQ,CAAC,eAAe,CAAC,SAAS,CAAC,CAAC;gBACzE,IAAI,SAAS,GAAG,UAAU,CAAC,YAAY,CAAC;gBACxC,IAAI,SAAS,GAAG,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,YAAY,EAAE,OAAO,CAAC,YAAY,EAAE,SAAS,EAAE,UAAU,CAAC,YAAY,EAAE,UAAU,CAAC,YAAY,CAAC,CAAC;gBAElI,EAAE,CAAA,CAAC,SAAS,IAAI,CAAC,CAAC,SAAS,GAAG,KAAI,CAAC,MAAM,CAAC,GAAG,SAAS,CAAC,CAAC,CAAC,CAAC;oBACtD,KAAI,CAAC,IAAI,EAAE,CAAC;gBAChB,CAAC;YACL,CAAC,CAAC,CAAC;QACP,CAAC;IAEL,CAAC;IAED,kCAAW,GAAX;QACI,QAAQ;QACR,EAAE,CAAA,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC,CAAC;YACrB,IAAI,CAAC,cAAc,EAAE,CAAC;YACtB,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC;QAC/B,CAAC;IACL,CAAC;IA1ID;QAAC,YAAK,EAAE;;+CAAA;IAER;QAAC,YAAK,EAAE;;8CAAA;IAER;QAAC,YAAK,EAAE;;8CAAA;IAER;QAAC,aAAM,EAAE;;oDAAA;IAET;QAAC,YAAK,EAAE;;+CAAA;IAER;QAAC,YAAK,EAAE;;oDAAA;IAER;QAAC,YAAK,EAAE;;gDAAA;IAER;QAAC,YAAK,EAAE;;gDAAA;IAER;QAAC,YAAK,EAAE;;sDAAA;IAER;QAAC,mBAAY,CAAC,eAAM,CAAC;;gDAAA;IAErB;QAAC,mBAAY,CAAC,eAAM,CAAC;;gDAAA;IAErB;QAAC,mBAAY,CAAC,kBAAW,CAAC;;sDAAA;IAE1B;QAAC,YAAK,EAAE;;gDAAA;IA/CZ;QAAC,gBAAS,CAAC;YACP,QAAQ,EAAE,gBAAgB;YAC1B,QAAQ,EAAE,q2BAgBT;YACD,SAAS,EAAE,CAAC,uBAAU,CAAC;SAC1B,CAAC;;oBAAA;IA8IF,mBAAC;AAAD,CAAC,AA7ID,IA6IC;AA7IY,oBAAY,eA6IxB,CAAA;AAOD;IAAA;IAAkC,CAAC;IALnC;QAAC,eAAQ,CAAC;YACN,OAAO,EAAE,CAAC,qBAAY,EAAC,qBAAY,CAAC;YACpC,OAAO,EAAE,CAAC,YAAY,EAAC,qBAAY,CAAC;YACpC,YAAY,EAAE,CAAC,YAAY,CAAC;SAC/B,CAAC;;0BAAA;IACgC,yBAAC;AAAD,CAAC,AAAnC,IAAmC;AAAtB,0BAAkB,qBAAI,CAAA","sourcesContent":["import {NgModule,Component,ElementRef,AfterViewInit,OnDestroy,DoCheck,Input,Output,Renderer,EventEmitter,ContentChild,IterableDiffers,TemplateRef} from '@angular/core';\r\nimport {CommonModule} from '@angular/common';\r\nimport {Header} from '../common/shared';\r\nimport {Footer} from '../common/shared';\r\nimport {SharedModule} from '../common/shared';\r\nimport {DomHandler} from '../dom/domhandler';\r\n\r\n@Component({\r\n    selector: 'p-dataScroller',\r\n    template: `\r\n    <div [ngClass]=\"{'ui-datascroller ui-widget': true, 'ui-datascroller-inline': inline}\" [ngStyle]=\"style\" [class]=\"styleClass\">\r\n        <div class=\"ui-datascroller-header ui-widget-header ui-corner-top\" *ngIf=\"header\">\r\n            <ng-content select=\"header\"></ng-content>\r\n        </div>\r\n        <div class=\"ui-datascroller-content ui-widget-content\" [ngStyle]=\"{'max-height': scrollHeight}\">\r\n            <ul class=\"ui-datascroller-list\">\r\n                <li *ngFor=\"let item of dataToRender\">\r\n                    <template [pTemplateWrapper]=\"itemTemplate\" [item]=\"item\"></template>\r\n                </li>\r\n            </ul>\r\n        </div>\r\n        <div class=\"ui-datascroller-footer ui-widget-header ui-corner-bottom\" *ngIf=\"footer\">\r\n            <ng-content select=\"footer\"></ng-content>\r\n        </div>\r\n    </div>\r\n    `,\r\n    providers: [DomHandler]\r\n})\r\nexport class DataScroller implements AfterViewInit,DoCheck,OnDestroy {\r\n\r\n    @Input() value: any[];\r\n\r\n    @Input() rows: number;\r\n\r\n    @Input() lazy: boolean;\r\n    \r\n    @Output() onLazyLoad: EventEmitter<any> = new EventEmitter();\r\n\r\n    @Input() style: any;\r\n\r\n    @Input() styleClass: string;\r\n    \r\n    @Input() buffer: number = 0.9;\r\n    \r\n    @Input() inline: boolean;\r\n    \r\n    @Input() scrollHeight: any;\r\n        \r\n    @ContentChild(Header) header;\r\n\r\n    @ContentChild(Footer) footer;\r\n    \r\n    @ContentChild(TemplateRef) itemTemplate: TemplateRef<any>;\r\n    \r\n    @Input() loader: any;\r\n\r\n    public dataToRender: any[] = [];\r\n\r\n    public first: number = 0;\r\n    \r\n    differ: any;\r\n    \r\n    scrollFunction: any;\r\n    \r\n    contentElement: any;\r\n\r\n    constructor(public el: ElementRef, differs: IterableDiffers, public renderer: Renderer, public domHandler: DomHandler) {\r\n        this.differ = differs.find([]).create(null);\r\n    }\r\n\r\n    ngAfterViewInit() {\r\n        if(this.lazy) {\r\n            this.load();\r\n        }\r\n        \r\n        if(this.loader) {\r\n            this.scrollFunction = this.renderer.listen(this.loader, 'click', () => {\r\n                this.load();\r\n            });\r\n        }\r\n        else {\r\n            this.bindScrollListener();\r\n        }\r\n    }\r\n    \r\n    ngDoCheck() {\r\n        let changes = this.differ.diff(this.value);\r\n\r\n        if(changes) {\r\n            if(this.lazy)\r\n                this.dataToRender = this.value;\r\n            else\r\n                this.load();\r\n        }\r\n    }\r\n    \r\n    load() {\r\n        if(this.lazy) {\r\n            this.onLazyLoad.emit({\r\n                first: this.first,\r\n                rows: this.rows\r\n            });\r\n        }\r\n        else {\r\n            for(let i = this.first; i < (this.first + this.rows); i++) {\r\n                if(i >= this.value.length) {\r\n                    break;\r\n                }\r\n\r\n                this.dataToRender.push(this.value[i]);\r\n            }\r\n        }\r\n        this.first = this.first + this.rows;\r\n    }\r\n     \r\n    reset() {\r\n        this.first = 0;\r\n        this.dataToRender = [];\r\n        this.load();\r\n    }\r\n\r\n    isEmpty() {\r\n        return !this.dataToRender||(this.dataToRender.length == 0);\r\n    }\r\n    \r\n    createLazyLoadMetadata(): any {\r\n        return {\r\n            first: this.first,\r\n            rows: this.rows\r\n        };\r\n    }\r\n    \r\n    bindScrollListener() {\r\n        if(this.inline) {\r\n            this.contentElement = this.domHandler.findSingle(this.el.nativeElement, 'div.ui-datascroller-content');\r\n            \r\n            this.scrollFunction = this.renderer.listen(this.contentElement, 'scroll', () => {\r\n                let scrollTop = this.contentElement.scrollTop;\r\n                let scrollHeight = this.contentElement.scrollHeight;\r\n                let viewportHeight = this.contentElement.clientHeight;\r\n\r\n                if((scrollTop >= ((scrollHeight * this.buffer) - (viewportHeight)))) {\r\n                    this.load();\r\n                }\r\n            });\r\n        }\r\n        else {\r\n            this.scrollFunction = this.renderer.listenGlobal('window', 'scroll', () => {\r\n                let docBody = document.body;\r\n                let docElement = document.documentElement;\r\n                let scrollTop = (window.pageYOffset||document.documentElement.scrollTop);\r\n                let winHeight = docElement.clientHeight;\r\n                let docHeight = Math.max(docBody.scrollHeight, docBody.offsetHeight, winHeight, docElement.scrollHeight, docElement.offsetHeight);\r\n                            \r\n                if(scrollTop >= ((docHeight * this.buffer) - winHeight)) {\r\n                    this.load();\r\n                }\r\n            });\r\n        }\r\n        \r\n    }\r\n    \r\n    ngOnDestroy() {\r\n        //unbind\r\n        if(this.scrollFunction) {\r\n            this.scrollFunction();\r\n            this.contentElement = null;\r\n        }\r\n    }\r\n}\r\n\r\n@NgModule({\r\n    imports: [CommonModule,SharedModule],\r\n    exports: [DataScroller,SharedModule],\r\n    declarations: [DataScroller]\r\n})\r\nexport class DataScrollerModule { }\r\n\r\n"]}